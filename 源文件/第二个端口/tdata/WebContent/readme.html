<!DOCTYPE html><html><head><title>web管理系统</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style></style></head><body><div id='preview-contents' class='note-content'>
                        
                    



<h2 id="web管理系统"><center>web管理系统</center></h2>

<hr>



<h3 id="1基本信息">1.基本信息</h3>

<pre class="prettyprint hljs-dark"><code class="hljs cpp">    前端语言：html + css + angularjs + bootstrap<br>    后端语言：java + spring + springmvc<br>    数据库：sqlserver <span class="hljs-number">2012</span><br>    应用服务器：tomcat <span class="hljs-number">7.0</span><br>    JDK版本：JDK <span class="hljs-number">1.8</span><br></code></pre>

<h3 id="2-数据库配置">2.   数据库配置</h3>

<pre class="prettyprint hljs-dark"><code class="hljs stylus"><span class="hljs-tag">a</span>. 数据库账户：sa<br><span class="hljs-tag">b</span>. 数据库密码:  Test123@<br>c. 数据库名称:  myoa<br>d. 数据库部署：打开sqlserver2012,通过sa账户建立一个名字为“myoa”的数据库，再点击文件-&gt;打开-&gt;文件-&gt;再找到压缩包的myoa.sql，点击执行，生成数据库信息。<br></code></pre>



<h4 id="数据库中的路径设置">数据库中的路径设置</h4>

<pre class="prettyprint hljs-dark"><code class="hljs tex">```CONTAINMENT = NONE<br>     ON  PRIMARY <br>    ( NAME = N'myoa', FILENAME = N'F:<span class="hljs-command">\sqlspace</span><span class="hljs-command">\MSSQL</span>11.MSSQLSERVER<span class="hljs-command">\MSSQL</span><span class="hljs-command">\DATA</span><span class="hljs-command">\myoa</span>.mdf' , SIZE = 5120KB , MAXSIZE = UNLIMITED, FILEGROWTH = 1024KB )<br> LOG ON <br>    ( NAME = N'myoa_log', FILENAME = N'F:<span class="hljs-command">\sqlspace</span><span class="hljs-command">\MSSQL</span>11.MSSQLSERVER<span class="hljs-command">\MSSQL</span><span class="hljs-command">\DATA</span><span class="hljs-command">\myoa</span>_log.ldf' , SIZE = 2048KB , MAXSIZE = 2048GB , FILEGROWTH = 10<span class="hljs-comment">%)</span><br>    GO<br>```<br>可以修改filename的路径<br></code></pre>

<h3 id="3ajax通信">3.ajax通信</h3>

<pre class="prettyprint hljs-dark"><code class="hljs cpp">参数说明：pId:玩家ID；pName:玩家昵称；pNumber:房卡数量;dNumber:减少的房卡数量<br>URL说明:<br>localhost:本地；<span class="hljs-number">8080</span>:端口号；tdata:项目名；<br>a.新增玩家信息<br>发送形如：http:<span class="hljs-comment">//localhost:8080/tdata/player/save?pId=12345&amp;&amp;pName=hz&amp;&amp;pNumber=122</span><br>返回的信息Json信息：<br><span class="hljs-number">1.</span>  成功信息：<br>    {<br>  <span class="hljs-string">"message"</span> : <span class="hljs-string">"success"</span>,<br>  <span class="hljs-string">"status"</span> : <span class="hljs-string">"1"</span><br>}<br><span class="hljs-number">2.</span>  错误信息：<br>{<br>    <span class="hljs-string">"message "</span>: <span class="hljs-string">"具体的错误信息"</span>,<br>    <span class="hljs-string">"status"</span> : <span class="hljs-string">"2"</span><br><br>}<br><br><br>b．更新玩家信息<br>发送形如：<br>        http:<span class="hljs-comment">//localhost:8080/tdata/player/update?pId=12345&amp;&amp;pName=hz&amp;&amp;pNumber=122</span><br>其中pId一定要有，如果只改pName就：<br>    http:<span class="hljs-comment">//localhost:8080/tdata/player/save?pId=12345&amp;&amp;pName=ja</span><br>如果只改pNumber就：<br>    http:<span class="hljs-comment">//localhost:8080/tdata/player/save?pId=12345&amp;&amp;pNumber=133</span><br>返回的信息Json信息：<br><span class="hljs-number">1.</span>  成功信息：<br>    {<br>  <span class="hljs-string">"message"</span> : <span class="hljs-string">"success"</span>,<br>  <span class="hljs-string">"status"</span> : <span class="hljs-string">"1"</span><br>}<br><span class="hljs-number">2.</span>  错误信息：<br>{<br>    <span class="hljs-string">"message "</span>: <span class="hljs-string">"具体的错误信息"</span>,<br>    <span class="hljs-string">"status"</span> : <span class="hljs-string">"2"</span><br><br>}<br><br>c.  删除玩家信息<br>发送形如：<br>http:<span class="hljs-comment">//localhost:8080/tdata/player/delete?pId=12345</span><br>只需要pId;<br><br>返回的信息Json信息：<br><span class="hljs-number">1.</span>  成功信息：<br>    {<br>  <span class="hljs-string">"message"</span> : <span class="hljs-string">"success"</span>,<br>  <span class="hljs-string">"status"</span> : <span class="hljs-string">"1"</span><br>}<br><span class="hljs-number">2.</span>  错误信息：<br>{<br>    <span class="hljs-string">"message "</span>: <span class="hljs-string">"具体的错误信息"</span>,<br>    <span class="hljs-string">"status"</span> : <span class="hljs-string">"2"</span><br><br>}<br><br>d.  查找玩家信息：<br>发送形如：http:<span class="hljs-comment">//localhost:8080/tdata/player/find?pId=12345</span><br>只需要pId<br>返回的信息Json信息：<br><span class="hljs-number">1.</span>成功信息：<br>{<span class="hljs-string">"pId"</span>:<span class="hljs-string">"12345"</span>,<span class="hljs-string">"pName"</span>:<span class="hljs-string">"jan96"</span>,<span class="hljs-string">"pNumber"</span>:<span class="hljs-string">"202"</span>}<br><span class="hljs-number">2.</span>错误信息：<br>{<br>    <span class="hljs-string">"message "</span>: <span class="hljs-string">"查询ID不存在或者其他异常！"</span>,<br>    <span class="hljs-string">"status"</span> : <span class="hljs-string">"2"</span><br><br>}<br><br><br>e.减少玩家放卡数量<br>发送形如：http:<span class="hljs-comment">//localhost:8080/tdata/player/decrease?pId=12345&amp;&amp;dNumber=5</span><br>返回的信息Json信息：<br><br><span class="hljs-number">1.</span>  成功信息：<br>{<br>  <span class="hljs-string">"message"</span> : <span class="hljs-string">"success"</span>,<br>  <span class="hljs-string">"status"</span> : <span class="hljs-string">"1"</span><br>}<br><span class="hljs-number">2.</span>  错误信息：<br>{<br>    <span class="hljs-string">"message "</span>: <span class="hljs-string">"具体的错误信息"</span>,<br>    <span class="hljs-string">"status"</span> : <span class="hljs-string">"2"</span><br><br> }<br></code></pre>



<h3 id="4项目结构">4.项目结构</h3>

<pre class="prettyprint hljs-dark"><code class="hljs stylus">    -tdata<br>        -javaresource    java资源包<br>            -src<br>                -com<span class="hljs-class">.web</span><span class="hljs-class">.common</span>   公用类包<br>                    BaseController<span class="hljs-class">.java</span>   基本的控制器 <br>                    CacheUtils<span class="hljs-class">.java</span>    缓存工具类<br>                    CookieUtils<span class="hljs-class">.java</span>    Cookie工具类<br>                    CustomeDateDetailSerializer<span class="hljs-class">.java</span>     日期格式化工具<br>                    DateUtils<span class="hljs-class">.java</span>    日期工具类<br>                    Encodes<span class="hljs-class">.java</span>    编码解码工具类<br>                    Exceptions<span class="hljs-class">.java</span>   异常工具类 <br>                    Global<span class="hljs-class">.java</span>    全局配置类<br>                    Md5Util<span class="hljs-class">.java</span>    MD5加密工具<br>                    PropertiesLoader<span class="hljs-class">.java</span>   Properties文件载入工具类.<br>                    Reflections<span class="hljs-class">.java</span>    反射工具类<br>                    SpringContextHolder<span class="hljs-class">.java</span>    bean获取工具类<br>                    StringUtils<span class="hljs-class">.java</span>    字符串工具类<br>                    UserUtils<span class="hljs-class">.java</span>    用户工具类<br>                    ValidateCodeServlet<span class="hljs-class">.java</span>    验证码servlet<br>                -com<span class="hljs-class">.web</span><span class="hljs-class">.controller</span>   控制管理类包<br>                    LoginController<span class="hljs-class">.java</span>    登陆控制器<br>                    PermissionController<span class="hljs-class">.java</span>   权限控制器<br>                    PlayerController<span class="hljs-class">.java</span>    玩家控制器<br>                    RechargeController<span class="hljs-class">.java</span>    充值控制器<br>                    RoleController<span class="hljs-class">.java</span>    角色控制器<br>                    SaleRecordController<span class="hljs-class">.java</span>   充值记录控制器<br>                    UserController   用户控制器<br>                -com<span class="hljs-class">.web</span><span class="hljs-class">.dao</span>    dao类包<br>                    BaseDao<span class="hljs-class">.java</span>    基本的dao类<br>                    PermissionDao<span class="hljs-class">.java</span>    权限dao类<br>                    PlayerDao<span class="hljs-class">.java</span>    玩家dao类<br>                    RoleDao<span class="hljs-class">.java</span>    角色dao类<br>                    SaleRecordDao<span class="hljs-class">.java</span>    充值记录dao类<br>                    UserDao<span class="hljs-class">.java</span>    用户dao类<br>                -com<span class="hljs-class">.web</span><span class="hljs-class">.entity</span>  实体类包<br>                    BaseEntity<span class="hljs-class">.java</span>    基本的实体类<br>                    DataEntity<span class="hljs-class">.java</span>    数据实体类<br>                    IdEntity<span class="hljs-class">.java</span>    ID实体类<br>                    IdGen<span class="hljs-class">.java</span>    ID生成策略实体类<br>                    Permission<span class="hljs-class">.java</span>   权限实体类<br>                    Player<span class="hljs-class">.java</span>   玩家实体类<br>                    Role<span class="hljs-class">.java</span>    角色实体类 <br>                    SaleRecord<span class="hljs-class">.java</span>    充值记录实体类<br>                    User<span class="hljs-class">.java</span>    用户实体类<br>                -com<span class="hljs-class">.web</span><span class="hljs-class">.mapper</span>    json转换包<br>                    JsonMapper<span class="hljs-class">.java</span>    json封装工具类<br>                -com<span class="hljs-class">.web</span><span class="hljs-class">.persistence</span>    持久类包<br>                    Page<span class="hljs-class">.java</span>    分页实体类<br>                -com<span class="hljs-class">.web</span><span class="hljs-class">.security</span>    安全管理类包<br>                    CaptchaException<span class="hljs-class">.java</span>    验证码异常处理类<br>                    CustomCredentialsMatcher<span class="hljs-class">.java</span>    自定义的密码验证类<br>                    DES<span class="hljs-class">.java</span>   DES加密解密工具类<br>                    FormAuthorizingRealm<span class="hljs-class">.java</span>    登录表单验证类<br>                    SystemAuthorizingRealm<span class="hljs-class">.java</span>    系统安全认证实现类<br>                    UsernamePasswordToken<span class="hljs-class">.java</span>    用户和密码（包含验证码）令牌类<br>                -com<span class="hljs-class">.web</span><span class="hljs-class">.service</span>    service包<br>                    SystemService<span class="hljs-class">.java</span>    系统service类<br>                -com<span class="hljs-class">.web</span><span class="hljs-class">.test</span>    测试包<br>                    test<span class="hljs-class">.java</span>    测试类<br>                springmvc-servlet<span class="hljs-class">.xml</span>    springmvc配置类<br>                ehcache-hibernate-local<span class="hljs-class">.xml</span>    指定的hibernateCache缓存配置<br>                ehcache-local<span class="hljs-class">.xml</span>    默认的缓存配置<br>                log4j<span class="hljs-class">.properties</span>    日志配置类<br>                spring-context-shiro<span class="hljs-class">.xml</span>    shiro安全管理配置类<br>                spring-context<span class="hljs-class">.xml</span>    spring配置管理类<br>            -source  资源配置<br>                config<span class="hljs-class">.propertiese</span>    配置<br>                mysql<span class="hljs-class">.propertiese</span>    数据库配置<br><br>    -webcontent<br>        -assets 静态资源管理类<br>            -css<br>                angular-<span class="hljs-tag">aside</span><span class="hljs-class">.css</span><br>                animate<span class="hljs-class">.min</span><span class="hljs-class">.css</span><br>                app<span class="hljs-class">.css</span><br>                <span class="hljs-attribute">font</span><span class="hljs-class">.css</span><br>            -js<br>                -controllers    angularjs的控制器<br>                    -app<span class="hljs-class">.js</span>    定义的app模块<br>                    -modalCtrl<span class="hljs-class">.js</span>    模态框控制器<br>                    -proxyCtrl<span class="hljs-class">.js</span>    代理用户控制器<br>                    -rechargeCtrl<span class="hljs-class">.js</span>    充值控制器<br>                    -saleRecordCtrl<span class="hljs-class">.js</span>    充值记录控制器<br>                -directive    指令控制<br>                    ui-fullscreen<span class="hljs-class">.js</span>    全屏指令<br>                    ui-scroll<span class="hljs-class">.js</span>     滚动指令<br>                    ui-toggleclass<span class="hljs-class">.js</span>    toggle指令<br>                -plugins    插件管理<br>                    -----省略-----<br>                -services    服务管理<br>                    ui-loda<span class="hljs-class">.js</span>   加载资源文件工具<br>                -config<span class="hljs-class">.js</span>    资源配置<br>                -lazyload<span class="hljs-class">.js</span>    懒加载配置<br>                -main<span class="hljs-class">.js</span>     主要信息配置<br>                -router<span class="hljs-class">.js</span>   路由信息配置<br><br>        -<span class="hljs-tag">html</span>    静态文件<br>            -blocks  布局资源<br>                <span class="hljs-tag">header</span><span class="hljs-class">.html</span>    头部页面<br>                <span class="hljs-tag">nav</span><span class="hljs-class">.html</span>    导航页面<br>                settings<span class="hljs-class">.html</span>   布局颜色设置页面<br>            -proxy  代理用户资源<br>                proxy<span class="hljs-class">.html</span>   代理用户资源<br>            -sale    充值以及充值记录页面<br>                recharge<span class="hljs-class">.html</span>    充值页面<br>                saleRecord<span class="hljs-class">.html</span>    充值记录页面<br>             -app<span class="hljs-class">.html</span>    主配置布局页面<br>             -errot<span class="hljs-class">.html</span>   错误页面<br>             -index<span class="hljs-class">.html</span>   入口页<br>             -login<span class="hljs-class">.html</span>    html登陆页面<br>             -syslogin<span class="hljs-class">.jsp</span>  jsp登陆页面<br>             -test<span class="hljs-class">.html</span>    测试页面<br>        -META-INF<br>        -WEB-INF<br>            -lib   jar包<br>            web<span class="hljs-class">.xml</span>    web配置 <br>        -readme<span class="hljs-class">.md</span>    必读使用信息<br></code></pre>



<h3 id="5使用详情">5.使用详情</h3>

<hr>



<h4 id="a增加权限信息comwebcontrollerpermissioncontrollerjava类中可以自定义权限的名称">a.增加权限信息（com.web.controller.PermissionController.java类中，可以自定义权限的名称）</h4>

<pre class="prettyprint hljs-dark"><code class="hljs stata"><span class="hljs-comment">/**<br> * 增加权限信息<br> * 权限分为四种：<br> * 1.增加 save<br> * 2.删除 delete<br> * 3.更新 update<br> * 4.查找 select <br> */</span><br>@RequestMapping(<span class="hljs-string">"save"</span>)<br>public String <span class="hljs-keyword">save</span>(){<br>    ArrayList&lt;String&gt; <span class="hljs-keyword">list</span> = new ArrayList&lt;String&gt;();<br>    <span class="hljs-comment">//往list中添加权限的名称</span><br>    <span class="hljs-keyword">list</span>.add(<span class="hljs-string">"save"</span>);<br>    <span class="hljs-keyword">list</span>.add(<span class="hljs-string">"delete"</span>);<br>    <span class="hljs-keyword">list</span>.add(<span class="hljs-string">"update"</span>);<br>    <span class="hljs-keyword">list</span>.add(<span class="hljs-string">"select"</span>);<br>    <span class="hljs-keyword">for</span>(int i = 0; i &lt; <span class="hljs-keyword">list</span>.size(); i++){<br>        <span class="hljs-keyword">DES</span> <span class="hljs-keyword">des</span> = new <span class="hljs-keyword">DES</span>();<br>        Permission permission = new Permission();<br>        permission.setPermissionName(<span class="hljs-keyword">des</span>.base64encoder.<span class="hljs-keyword">encode</span>(<span class="hljs-keyword">des</span>.encrypt((<span class="hljs-keyword">list</span>.<span class="hljs-literal">get</span>(i)).getBytes(), <span class="hljs-keyword">des</span>.PASSWORD)));<br>        <span class="hljs-comment">//存储到数据库</span><br>        systemService.<span class="hljs-keyword">save</span>(permission);<br>    }<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"index.html"</span>;<br>}<br></code></pre>



<h4 id="b用户角色权限-comwebcontrollerrolecontrollerjava">b.用户角色权限 （com.web.controller.RoleController.java)</h4>

<pre class="prettyprint hljs-dark"><code class="hljs stata">    <span class="hljs-comment">/**<br>     *赋予system角色所有权限 <br>     */</span><br>Role role1 = new Role();<br>    role1.setRoleName( <span class="hljs-keyword">des</span>.base64encoder.<span class="hljs-keyword">encode</span>(<span class="hljs-keyword">des</span>.encrypt((<span class="hljs-string">"system"</span>).getBytes(), <span class="hljs-keyword">des</span>.PASSWORD)));<br>    <span class="hljs-comment">//查找系统角色的权限</span><br>    <span class="hljs-keyword">List</span>&lt;Permission&gt; list1 = systemService.findAllList();<br>    role1.setRolePermission(list1);<br>    systemService.<span class="hljs-keyword">save</span>(role1);<br></code></pre>

<hr>

<pre class="prettyprint hljs-dark"><code class="hljs stata">    <span class="hljs-comment">/**<br>     * 赋予admin角色所有权限<br>     */</span><br>    <span class="hljs-comment">//查找管理员角色权限</span><br>    Role role2 = new Role();<br>    role2.setRoleName( <span class="hljs-keyword">des</span>.base64encoder.<span class="hljs-keyword">encode</span>(<span class="hljs-keyword">des</span>.encrypt((<span class="hljs-string">"admin"</span>).getBytes(), <span class="hljs-keyword">des</span>.PASSWORD)));<br>    <span class="hljs-keyword">List</span>&lt;Permission&gt; list2 = systemService.findAllList();<br>    role2.setRolePermission(list2);<br>    systemService.<span class="hljs-keyword">save</span>(role2);<br></code></pre>

<hr>

<pre class="prettyprint hljs-dark"><code class="hljs stata">    <span class="hljs-comment">/**<br>     * 赋予代理用户select权限<br>     */</span><br>    <span class="hljs-comment">//查找代理角色权限</span><br>    Role role3 = new Role();<br>    role3.setRoleName( <span class="hljs-keyword">des</span>.base64encoder.<span class="hljs-keyword">encode</span>(<span class="hljs-keyword">des</span>.encrypt((<span class="hljs-string">"proxy"</span>).getBytes(), <span class="hljs-keyword">des</span>.PASSWORD)));<br>    <span class="hljs-keyword">List</span>&lt;Permission&gt; list3 = new ArrayList&lt;Permission&gt;();<br>    <span class="hljs-keyword">for</span>(int i = 0; i &lt; list2.size(); i++){<span class="hljs-comment">//查找所有权限中等于select的，赋予给代理角色</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">"select"</span>.equals(new <span class="hljs-literal">String</span>(<span class="hljs-keyword">des</span>.decrypt(<span class="hljs-keyword">des</span>.base64decoder.decodeBuffer(list2.<span class="hljs-literal">get</span>(i).getPermissionName()),<span class="hljs-keyword">des</span>.PASSWORD)))){<br>            list3.add(list2.<span class="hljs-literal">get</span>(i));<br>            role3.setRolePermission(list3);<br>            <span class="hljs-keyword">break</span>;<br>        }<br>    }<br>    systemService.<span class="hljs-keyword">save</span>(role3);<br></code></pre>



<h4 id="c用户角色权限-的使用">c.用户角色权限 的使用</h4>

<pre class="prettyprint hljs-dark"><code class="hljs php">    <span class="hljs-comment">/**<br>*package com.web.security.SystemAuthorizingRealm.java;<br> * 授权查询回调函数, 进行鉴权但缓存中无用户的授权信息时调用<br> *当有<span class="hljs-doctag">@RequiresPermissions</span>时才调用，是从当前用户对应的角色的权限<br> */</span><br>@Override<br><span class="hljs-keyword">protected</span> AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {<br>    System.out.println(<span class="hljs-string">"授权查询回调函数-------------"</span>);<br>    Principal principal = (Principal) getAvailablePrincipal(principals);<br>    User user = getSystemService().getUserByLoginId(principal.getLoginId());<br>    <span class="hljs-keyword">if</span> (user != <span class="hljs-keyword">null</span>) {<br>        UserUtils.putCache(<span class="hljs-string">"user"</span>, user);<br>        SimpleAuthorizationInfo info = <span class="hljs-keyword">new</span> SimpleAuthorizationInfo();<br>        <span class="hljs-comment">/**<br>         *  添加基于Permission的权限信息，先查找用户角色，再查找角色拥有的权限<br>         */</span><br>        DES des = <span class="hljs-keyword">new</span> DES();<br>        <span class="hljs-keyword">List</span>&lt;String&gt; <span class="hljs-keyword">list</span> = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<br>        <span class="hljs-keyword">List</span>&lt;Permission&gt; permissions = user.getRole().getRolePermission();<br>        <span class="hljs-keyword">for</span>(Permission p:permissions){<br>            String s = <span class="hljs-keyword">null</span>;<br>            <span class="hljs-keyword">try</span> {<br>                s = <span class="hljs-keyword">new</span> String(des.decrypt(des.base64decoder.decodeBuffer(p.getPermissionName()),des.PASSWORD));<br>            } <span class="hljs-keyword">catch</span> (IOException e) {<br>                <span class="hljs-comment">// TODO Auto-generated catch block</span><br>                e.printStackTrace();<br>            } <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">Exception</span> e) {<br>                <span class="hljs-comment">// TODO Auto-generated catch block</span><br>                e.printStackTrace();<br>            }<br>            <span class="hljs-keyword">list</span>.add(s);<br>        }<br>        info.addStringPermissions(<span class="hljs-keyword">list</span>);<br>        <span class="hljs-comment">// 更新登录IP和时间</span><br>        <span class="hljs-comment">//getSystemService().updateUserLoginInfo(user.getId());</span><br>        <span class="hljs-keyword">return</span> info;<br>    } <span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    }<br>}<br></code></pre>

<hr>

<pre class="prettyprint hljs-dark"><code class="hljs less">使用权限信息例子<br><span class="hljs-comment">/**<br> * 新增房卡充值记录<br> * @param sr 充值记录类<br> * @return Map 成功或者错误的json消息<br> */</span><br><span class="hljs-variable">@RequiresPermissions</span>(value={<span class="hljs-string">"update"</span>,<span class="hljs-string">"save"</span>})<span class="hljs-comment">//规定的角色权限才能访问</span><br><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"save"</span>)<br><span class="hljs-variable">@ResponseBody</span><br>public Map <span class="hljs-function">update</span>{<br>}<br></code></pre></div></body></html>